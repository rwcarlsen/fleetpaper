\documentclass{style}

%%%%%% acronyms %%%%%%
\usepackage[acronym,toc]{glossaries}
\newacronym{MIT}{MIT}{the Massachusetts Institute of Technology}
\newacronym{UW}{UW}{University of Wisconsin}
%\newacronym{<++>}{<++>}{<++>}
\makeglossaries

\usepackage[printwatermark]{xwatermark}
\usepackage{xcolor}
\newwatermark[allpages,color=black!5,angle=45,scale=6,xpos=-40,ypos=40]{DRAFT}

%%%%%%%% cover info %%%%%%%%%%%%%%%
\title{Facility and Time Step Discretization Effects in Fuel Cycle Simulation}
\author{Robert~W.~Carlsen, Paul~P.H.~Wilson}

\institute{University of Wisconsin - Madison, Department of Nuclear Engineering and Engineering Physics, Madison, WI 53706}
\submitter{Robert W. Carlsen}
\submitteraddress{229 N Midvale Blvd Apt 1, Madison, WI 53705}
\submitteremail{rwcarlsen@gmail.com}

% No more than three keywords, though each can be a phrase
\keywords{nuclear fuel cycle, simulation, TODO:third}

%%%%%%%%% includes and commands %%%%%%%%%%

\usepackage{graphicx}
\usepackage{placeins}
\usepackage{tabularx}
\usepackage{booktabs} % nice rules for tables
\usepackage{microtype} % if using PDF
\usepackage{xspace}
\usepackage{hyperref}
\usepackage{caption}
\usepackage{cite} % order citations correctly
\usepackage{float} % used to help position figures with the H modifier

\newcommand{\Cyclus}{\textsc{Cyclus}\xspace}%
\newcommand{\Cycamore}{\textsc{Cycamore}\xspace}%
\date{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

TODO: add table titles
TODO: adjust figure fonts to meet NT guidlines

\newpage

\begin{abstract}

Due to the diversity of fuel cycle simulator modeling assumptions, direct
comparison and benchmarking can be difficult.  In 2012 the Organisation for
Economic Co-operation and Development (OECD) completed a benchmark study that
is perhaps one of the most complete published comparisons performed.  Despite
this, however, various results from the simulators were often significantly
different due to inconsistency in modeling decisions involving reprocessing
strategies, refueling behavior, reactor end-of-life handling, etc.  This work
attempts to identify and quantify the effects of selected modeling choices
that may sometimes be taken for granted in the fuel cycle modeling domain.
Four scenarios are compared using combinations of either fleet-based or
individual reactors with either monthly or quarterly (3-month) time steps.
The Cyclus fuel cycle simulator's plug-in facility cability along with its
market-like dynamic material routing allow it to be used as a level playing
field for comparing the scenarios.  When under supply-constraint pressure, the
four cases exhibit noticably different behavior.  Fleet-based modeling is more
efficient in supply-constrained environments at the expense of losing insight
on issues such as realistically suboptimal fuel distribution and challenges in
reactor refueling cycle staggering.  Finer-grained time steps also enable more
efficient material use in supply-constrained environments.  Large simulations
with fleet-based reactors run much more quickly than their individual reactor
counterparts.

\end{abstract}

\pagebreak

\section{Introduction}

The diversity of assumptions embedded within various fuel cycle simulators pose challenges for direct
comparison and benchmarking.  In 2012 the Organisation for
Economic Co-operation and Development (OECD) completed a benchmark study
\cite{oecd2012benchmark} that is perhaps one of the most complete published
comparisons performed.  Despite this, however, various results from the
different simulators were often significantly different due to inconsistent
modeling decisions involving reprocessing strategies, refueling behavior,
reactor end-of-life handling, etc.  This work attempts to identify and
quantify the effects of selected modeling choices relative to facility modeling
discretization (i.e. individual facilities vs. aggregate fleets) and time step
duration.  A better understanding of how these affect fuel cycle dynamics can
allow for making more deliberate decisions with respect to tradeoffs such as
computational investment vs. realism.

\subsection{Motivation and Background}

Traditionally, many fuel cycle simulators have used a system dynamics approach
\cite{forrester_industrial_1961} to modeling. These simulators model several
"stocks" representing isotopes or isotope groups that have levels that change
over time due to "flows" between them.  The flows are determined by equations
that are a function of the state of the system (i.e. the system's stocks).  A
constructed system is then solved in discrete or continuous time depending on
the limitations of the software and constraints imposed by the model.  In
system dynamics based simulators, the number of stocks and potential flows between
them is generally a static property of the modeled system, making it somewhat
difficult to swap different reactor models in and out of the same scenario
without wiring them into the simulator manually.

System dynamics based fuel cycle simulators generally use a collection of
stocks to represent the state of groups of like-facilities commonly referred
to as "fleets".  As the simulation steps through time, the levels of stocks
(e.g. reactor fresh fuel inventory, repository waste inventories, etc.) are
adjusted according to the calculated flow values.  Fuel cycle simulators that model
facility fleets built on a system dynamics foundation include VISION
\cite{jacobson_verifiable_2010}, DANESS \cite{van_den_durpel_daness_2009},
DYMOND, and ORION \cite{gregg_orion_2012} among
others.  In fleet-based modeling:

\begin{itemize}

    \item Groups of facilities (usually all facilities of a given type) are
        treated as a single, aggregate entity.

    \item Resource flows are often (approximately) continuous (limited by time
        step discretization).

\end{itemize}

This work investigates in detail some differences between fleet vs. individual
reactor modeling.  The difference between these two modeling styles in terms
of their affects on output of fuel cycle simulators in general is not well
known. This analysis is designed to provide both quantitative and
qualitative insight about how fleet-based continuous flow models differ from
individual facility discrete flow models.

Many fuel cycle simulators step through time in discrete steps.  The duration
of a single time step can have significant impact on the dynamics of a
simulation.  The time step duration can affect the magnitude of individual
material transfers between facilities and correspondingly affects the noise
level in facility material inventories and flows.  It can also act as a
minimum bound for outage durations and is a minimum bound in general for state
changes within the entire system. The effects of the time step duration are
also investigated together with fleet vs facility modeling.

Questions of interest include:

\begin{itemize}

    \item What effects drive differences in fleet-based and individual-based
        facility modeling?

    \item How does changing the time step duration affect simulations?

    \item Does the impact of changing time step duration differ in fleet-based
        and individual-based facility modeling?

\end{itemize}

\subsection{CYCLUS}

One of the major motivations for the development of the Cyclus fuel cycle
simulator \cite{cyclus_2015} was creating a simulation environment that is
more expressive than more traditional fuel cycle simulators.  Cyclus was
designed with a plugin-style architecture that allows different models for
facility types, known as \emph{archetypes}, to be swapped in and out easily.

As a Cyclus simulation walks through each time step, facilities engage in a
market-like dynamic resource exchange (DRE).  They broadcast requests for
material and potential supplying facilities respond with bids. The requesting facilities then
express preferences between all their bids, and the DRE then generates a network
flow problem that is optimized to resolve which transactions actually occur.
The plugin architecture combined with the DRE creates a powerful and flexible
environment for the natural comparison of different modeling paradigms.
Cyclus' module plug-in based architecture in concert with its DRE has the ability to
model fleet-based facilities.  Additionally, however, Cyclus can model
facilities individually with discrete flows enabling the investigation of
interesting real-world effects such as competition, reactor cycle staggering,
and individual reactor outages. 

Cyclus was designed to operate natively in unix/linux type environments with
flexible and scriptable usage and input file format.  Cyclus stores its
comprehensive output data in a powerful open-source database format.  In addition
to information about material flows and facility deployments, Cyclus'
single-file database contains the simulation input file, version information
about the archetypes used in a simulation, the version of Cyclus used to run
the simulation, and the installed versions of Cyclus dependencies. This and
other features of Cyclus lend themselves well to automation, research
provenance and reproducibility, and large-scale computing.

\section{Methodology}

A single fuel cycle transition scenario is used with a few modeling variations
resulting in four different cases:

\begin{enumerate}

    \item \emph{Case MI}: Monthly time steps with individual reactor modeling
    \item \emph{Case MF}: Monthly time steps with fleet reactor modeling
    \item \emph{Case QI}: Quarterly (3-month) time steps with individual reactor modeling
    \item \emph{Case QF}: Quarterly (3-month) time steps with fleet reactor modeling

\end{enumerate}

The case labels consist of two letters each: "M" for monthly time steps, "Q"
for quarterly time steps, "I" for individual reactors, and "F" for fleet
reactors.

Conducting this analysis involved developing some additional capability
in/around Cyclus.  Three primary pieces to the methodology are:

\begin{itemize}

    \item A fleet-based reactor model.

    \item A simulation scenario with both initial conditions and transition
        details.

    \item Theory and metrics for comparing differences between the four cases.

\end{itemize}

Because the standard package of archetypes included with Cyclus does not
include a fleet-based reactor model, one was necessarily developed. A
simulation scenario was created that is roughly based on prior and ongoing
work in the Department of Energy (DOE) fuel cycle options campaign.  A few
phenomena related to the different modeling choices in each of the four cases
are identified and used as a basis for comparison.  These are
described in more detail in the following sections.

\subsection{Fleet Reactor Implementation}

A fleet reactor archetype was created for Cyclus.  The flexibility of Cyclus
makes it relatively straight forward to create plug-in archetypes to model
anywhere along the spectrum from individual, discrete facilities to
continuous flow fleet facilities.  In order to contrast well with individual,
single-facility granularity modeling, the fleet archetype created here falls more
toward the aggregate, continuous flow side of the spectrum.  

The fleet reactor, although a single entity modeling many reactors, is
actually designed to look like many individual reactors to the cyclus
simulator kernel. This "trick" allows other plugins for managing facility
deployments to transparently work with the fleet reactor without having to
know anything about the fleet paradigm.  The fleet reactor has several
important characteristics described below:

\begin{itemize}

    \item Reactor capacity is deployed and retired in single reactor units
        (e.g. 1 GWe LWRs).

    \item Material is discharged from the fleet's reactor cores continuously
        (every time step) according to the following equation:

        \begin{equation}
            D =
            \frac{B}{L} \cdot N_{r} \cdot \frac{C_{inv}}{C_{cap}}
            \label{eqn:fleet-discharge}
        \end{equation}

        $D$ is the discharge rate (kg per time step), $B$ is the batch size
        (kg) for a single reactor's batch, $L$ is the cycle length (including
        refueling time) in time steps, $N_{r}$ is the number of reactors in
        the fleet, $C_{inv}$ is the total amount of fuel in all reactor cores
        (kg), and $C_{cap}$ is the total fuel capacity for all reactor cores
        (kg).  The last fractional term accounts for lower fuel burning rates
        due to unfueled reactors.

    \item Refueling occurs continuously with as much fresh fuel as is
        available up to the total amount to fill all reactor cores in the
        fleet.  No extra fuel is kept on-hand - it is all ordered
        just-in-time.

    \item Generated power is computed similarly to core discharge rates by
        multiplying the total fleet power capacity by the same last fractional
        term of Equation \ref{eqn:fleet-discharge} to account for unfueled
        capacity in the fleet.

    \item When a reactor in the fleet is retired, a full core of material is
        discharged - even if there is some fraction of the fleet with unfueled
        cores.
        
\end{itemize}

One characteristic of this fleet reactor implementation is that it has perfect
fuel sharing and perfect cycle staggering among the individual reactors it
models.  The first discharge of spent fuel begins immediately on
the first time step of operation rather than after a complete refueling cycle.
Fuel shortages also only cause proportional loss of capacity rather than
whole-reactor quantized shutdown.  The full implementation of the fleet-based
reactor is publicy available for download and use \cite{Carlsen2015}.

\subsection{Scenario Description}

The scenario modeled approximates a transition from a the current once-through light water
reactor (LWR) fleet to a full sodium fast reactor (SFR) fuel cycle within evaluation group 23 (EG-23)
in the DOE's Advanced Nuclear Fuel Cycle Options report
\cite{wigeland_nuclear_2014}. Scenario and transition details were patterned
after ongoing work by the DOE in their Fuel Cycle Options campaign.

The scenario starts with 100 LWRs and follows an exponential curve with a 1\%
annual growth rate for 200 years.  The decommissioning of the initial 100
reactors is staggered over years 15 to 55.  Fresh fuel for LWRs is provided directly from enrichment with infinite supply and throughput. In year 35, fast reactors become available for
deployment and no more thermal reactors are built.  LWR spent fuel separations
begins in year 15 with 2000 MTHM/yr capacity and increases to 3000 MTHM/yr in
year 25.  Fast reactor spent fuel separations and fuel fabrication have
infinite capacity.  All spent fuel is stored/cooled for 7 years before it becomes
available for separation: 5 years for cooling and an additional 2 years to approximate non-instantaneous separations and fabrication times. Figure \ref{fig:flow} shows the material flow
relationships between the facilities.  Compositions used for the simulations
were simple containing primarily $^{238}U$, $^{235}U$, $^{239}Pu$, $^{241}Am$,
and small quantities of a few lanthanides.  Full composition details can be
found in the Cyclus input files used \cite{Carlsen2015}.

\begin{figure}[!h]
    \centering
    \includegraphics[width=0.47\textwidth]{exp2/flow.eps}
    \caption[Material flow paths]{Potential material flow paths between facility types.}
    \label{fig:flow}
\end{figure}

A pre-release of Cyclus version 1.4 was used for this analysis.  Archetypes
used were the standard ones provided with Cyclus in the included Cycamore
library - also a pre-release of version 1.4.  A custom storage archetype was
used because Cycamore did not yet provide one.  The standard cycamore reactor archetype
was used for both LWR and SFR reactor types in cases MI and QI.  Correspondingly
the custom fleet-based reactor archetype described earlier was used for both reactor
types in cases MF and QF.  Additional configuration for the reactor types is
shown in Table \ref{tab:reactors}.

\vspace{2mm}

\begin{table}[h]
    \centering
    \begin{tabular}{ |r | c c | }
        \hline                       
            & LWR & SFR \\
        \hline                       
        Lifetime (yr)         & 80 & 80 \\
        Cycle length (months) & 18 & 14 \\
        Batch size (kg)       & 29565 & 7490 \\
        Batches per core      & 3 & 5 \\
        \hline                       
    \end{tabular}
    \captionsetup{justification=centering}
    \caption[Reactor facility parameters]{Reactor facility parameters. Cycle length includes the refueling outage.}
    \label{tab:reactors}
\end{table}

The described scenario is used as closely as possible in each of the four
cases.  However, a few small case-dependent changes to the scenarios relating to
reactor configuration are necessary.  For the cases using quarterly time steps
with individual reactors, cycle and outage times must be adjusted to be a
multiple of 3 months.  In order to make the comparison more valid, the cases
with monthly time steps are also adjusted to have identical cycle and outage
times.  The invariants preserved with respect to reactor behavior between all
four cases are shown in Table \ref{tab:invar}.  Table \ref{tab:reactor-detail} shows
the computed/selected configuration for both LWR and SFR reactor types for all
four cases.

\begin{table}
    \centering
    \begin{tabular}{ |r | c c | }
        \hline                       
                                                                             & LWR      & SFR      \\
        \hline                       
                                                                             &          &          \\
        Discharge Rate ($\frac{\text{kg} \cdot \text{HM}}{\text{month}}$)           & 1642.5   & 535      \\
                                                                             &          &          \\
        Burnup  ($\frac{\text{MWe} \cdot \text{month}}{\text{kg} \cdot \text{HM}}$) & 0.547945 & 0.672897 \\
                                                                             &          &          \\
        Effective Power  ($\text{MWe}$)                                      & 900      & 360      \\
                                                                             &          &          \\
        Core Size  ($\text{kg} \cdot \text{HM}$)                                    & 88695    & 40125    \\
                                                                             &          &          \\
        \hline                       
    \end{tabular}
    \captionsetup{justification=centering}
    \caption[Reactor parameter invariants]{
        Reactor configuration invariants maintained across all four
        simulation cases.
    }

    \label{tab:invar}
\end{table}

\begin{table*}
    \centering
    \begin{tabular}{ |r | c c | c c | }
        \hline                       
                                          & \multicolumn{2}{c |}{LWR}       & \multicolumn{2}{c |}{SFR} \\
                                          & Cases MI,QI & Cases MF,QF (fleet) & Cases MI,QI & Cases MF,QF (fleet)  \\
        \hline                       
        Cycle length (months)             & 15        & 18                & 12        & 15 \\
        Refueling outage (months)         & 3         & 0                 & 3         & 0 \\
        Batch size ($\text{kg} \cdot \text{HM}$) & 29,565    & 29,565            & 8,025     & 40,125 \\
        Power capacity (MWe)              & 1,080     & 900               & 450       & 360 \\
        \hline                       
    \end{tabular}
    \captionsetup{justification=centering}
    \caption[Reactor parameters by case]{
        Reactor configuration for each of the four simulation cases.
    }

    \label{tab:reactor-detail}
\end{table*}

In each of the four cases, the initial 100 LWRs are modified to have a zero
length refueling outage with an explicit 900 MWe net power output capacity.  Because the
individual reactor model doesn't have any way to start a reactor mid-cycle,
this was done to avoid having all initial LWRs refuel at the same time.  The
parameters for each case were also selected to keep capacity factors for
individual reactors very roughly around 90\%.

Instead of annual deployments, a longer 21-month deployment period is used
because it provides better natural staggering for the reactor refueling
cycles. The same deployment schedule is used for all four cases; power
capacity is built along a curve starting at 100GWe in year zero following the
1\% exponential growth curve.  This particular deployment schedule is chosen
because it causes significant fuel shortages providing interesting features to
investigate and compare.

All input files and other assets used in the analysis for each of the four
cases are publicly available for download and use \cite{Carlsen2015}.

\subsection{Modeling Effects}

There are various low level phenomena that have potential to affect the larger
outcome of simulations with respect to facility discretization and time step modeling
decisions. Several effects are described below that arise from these
different modeling choices.

One difference between the fleet and individual facility modeling is the
\emph{quantized shutdown effect}.  If a fleet-based reactor modeling 3-batch
cores is short one half batch of fuel, it will produce $\frac{2.5}{3}\cdot C$
of power for that time step where $C$ is the power capacity of a single
reactor of the fleet (e.g. 1000 MWe).  If an individually modeled reactor is
short a half batch of fuel, then it will produce no power ($0 \cdot C$) that
time step.  Time step duration can also have this effect.  For both fleet and
individual reactor modeling, power goes offline in full time step increments.
For example, if a 3-batch fleet based reactor is short $\frac{1}{2}$ batch of
fuel with a 3 month time step, then it will produce $\frac{2.5}{3} \cdot 3
\text{mo} \cdot C $ of energy.  In contrast, a monthly time step might allow
the same reactor to produce $[\frac{5}{6} \cdot 1 \text{mo} + 1 \cdot 2
\text{mo}] \cdot C $ of energy if the fuel shortage actually ended after only
1 month.  Quantifying this effect directly is difficult.  One way of observing
it is to compare fleet reactor scenarios that have different time step
durations (i.e. cases MF and QF).  Because the fleet reactors have perfect fuel
sharing (described below) and no noise from refueling outages, differences observed will
likely be due to quantized shutdown.

Individually modeled reactors each have their own refueling cycles.  Depending
on how the refueling cycles and outages are staggered, power production can
vary significantly.  For example, if all reactors refuel at the same time,
then all reactors are offline at the same time.  This is referred to as the
\emph{cycle staggering effect} and does not occur in fleet-based reactor
models.  An example of poor cycle staggering is shown in Figure
\ref{fig:sync-cycle}.  This effect can be naturally observed as the
fluctuations in the difference between deployed power capacity and generated
power.  The figure shows power jumping above and below the installed net
capacity (includes capacity factor) from time step to time step depending on
how many reactors are online/offline together.

Poor reactor cycle staggering can also cause spikes of material supply and
demand that can lead to suboptimal resource utilization.  Consider a fuel
fabrication facility that receives requests for new batches for every reactor
all at once.  The reactors draw out inventory from the fuel fabrication
facility together in a large quantity of orders.  If the fabrication facility
does not have enough material on hand, some number of reactors will need to
wait until enough fuel can be fabricated.  Avoiding such
constraints would require the fabrication facility to maintain suboptimally
large on-hand inventories as a contingency.  Even with infinite material
availability, poor staggering can result in supply constraints caused by
finite facility throughput. Even if the fuel fabrication facility above has
infinite material supply that it can keep on hand, it might not be able to
fabricate fuel for all reactor requests all at once even though it has
sufficient capacity if they request fuel uniformly over time.

\begin{figure}[h]
    \centering
    \includegraphics[width=1.0\columnwidth]{exp2/sync-cycle.eps}
    \caption[The cycle staggering effect]{
        In this scenario, reactors are deployed annualy with a refueling cycle
        length (including outage) of 18 months.  So all reactors deployed
        every 3rd year refuel together.  All initial 100 LWRs start out with
        their cycles synced as well.  While it may look like separate curves,
        generated power curve (purple) represents only a single time series with many discontinuities.
    }
    \label{fig:sync-cycle}
\end{figure}

Another difference between fleet-based and individual facility modeling
involves fuel sharing.  Power production by a group of individual reactors for
a fixed amount of fuel shortage may vary depending on how available fuel is
distributed.  This is illustrated in Figure \ref{fig:fuel-sharing}.  A system
being short 3 batches might mean that one reactor has no batches and isn't
operating or that 3 reactors are each missing a single batch.  This is
referred to as the \emph{fuel sharing effect}.  Fleet reactors, by design,
have perfect fuel sharing - all fuel is distributed so that the minimum
possible amount of capacity is offline during shortages. The most correct
measure of fuel sharing inefficiency is the difference between the actual
generated power and the maximum amount of power that could have been generated
among all possible fuel distribution alternatives.  This is difficult to
actually compute. One possible approximation is to count the number of fresh
fuel batches distributed to reactors that ended up not having enough fuel to
operate (i.e. a full core) that time step.  This approximation assumes that
every "wasted" batch of fuel, could have been given to a reactor that only
needed one batch to operate.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\columnwidth]{exp2/fuel-sharing.pdf}
    \caption[The fuel sharing effect]{
        A simple diagram showing effects of constrained fuel supply
        distribution choices. In both cases A and B, reactor 1 needs 3 new
        fuel batches to operate and reactors 2 and 3 each need 1 fresh batch.
        In case A, the two batches are given to reactors 2 and 3, resulting in
        reactor 1 remaining offline. In case B, the available fuel batches are
        given to reactor 1 resulting in all three reactors being offline.
    }
    \label{fig:fuel-sharing}
\end{figure}

One important phenomenon related to time step duration is the \emph{inventory
drawdown effect}.  Increasing time step duration reduces the frequency over
which refueling can occur, resulting in larger impulse drawdown on
inventories. This by itself is not problematic because this is balanced by
correspondingly larger inventory top-up quantities.  However, another component of
this effect is the simultaneity of incoming and outgoing material flows on a
given time step.  Within a particular time step facilities do not know about
incoming material when they make commitments for outgoing material.  For
longer time steps, larger incoming quanta of material are not available for
making offers. In general longer time steps create a need for larger floating
inventory buffers in order to avoid material shortages.  Another aspect of
this effect is that at least one time step is required for a material object to move between two facilities. Larger time steps result in longer minimum
bounds on time to traverse paths between facilities. Although direct measures
of this effect are difficult, some of its consequences (e.g. higher standing
inventories during shortages) can be quantified by comparing scenarios with
different time step durations (e.g. cases MF and QF).

There are also performance differences between the two modeling paradigms.  A
single 200 year simulation with several hundred fleet-based reactors takes
about 2 seconds to run on a typical desktop machine where the same simulation
using individual reactor facilities takes about 20 seconds.  This order of
magnitude difference is an important tradeoff to keep in mind when doing fuel
cycle analysis in general, particularly when considering optimization or
sensitivity studies where running thousands or millions of simulations may be
desirable.  The time step duration has less impact on performance because the
amount of work being done in the simulation is similar; in the monthly time
step cases most facilities (i.e. all reactors) only perform actions every
refueling cycle rather than every time step.

\section{Results}

All results data, analysis tools and instructions are publicly available for
download and use at \url{http://dx.doi.org/10.6084/m9.figshare.1546775}
\cite{Carlsen2015}.

\subsection{Power Production}

Figure \ref{fig:power} shows an overall view of the generated power over time
for each of the four cases.  Figure \ref{fig:power-rel} normalizes the Figure
\ref{fig:power} curves to the expected exponential power curve magnifying some
interesting differences between the four cases.  For the first 100 years, the
four cases behave somewhat similarly, although the individually modeled
reactors in cases MI and QI actually go offline and back online for refueling
causing more variance.  Around year 100, a fuel shortage begins and more
significant differences between the four cases become apparent. This fuel
shortage lasts until about year 140. The power generated in case QF is slightly
lower than in case MF during the fuel shortage years. This is primarily due to
the \emph{quantized shutdown effect}.  The longer 3-month time step in case QF 
results in reactor capacity going offline longer than necessary.

During the initial 100 years, cases MI and QI have larger variance in power
output than cases MF and QF.  This is caused by minor refueling cycle
synchronization.  The \emph{cycle staggering effect} becomes much more visible
during and after the fuel shortage as evidenced by the larger swings in power
generation from time step to time step.  Initially, the reactor cycles are
staggered well.  During the shortage, several reactors that previously had
staggered cycles are all offline together waiting for fuel.  On time steps
where reactors retire (not just during the shortage), new deployments are made
to replace them in addition to new deployments made to address power demand
growth.  Because the initial reactors retire in waves somewhat close together,
there are corresponding waves of deployment, and these waves are echoed every
80 years (the reactor lifetime).  These waves of deployment cause waves in
recycled fuel availability that cause many of the reactors offline during the
shortage to receive fuel and come online together.  The net effect is that the
fuel shortage degrades reactor cycle stagering overall.  As the simulation
continues, however, new reactors continue to be deployed and reactors with
synchornized cycles retire resulting in a gradual return to better
staggering visible by the end of the 200 years.

\begin{figure*}[!h]
    \centering
    \includegraphics[width=1.0\textwidth]{exp2/power.eps}
    \caption[Generated power]{
        Generated power for all four cases.  A fuel shortage occurs from about
        year 100 to about year 140.  In cases MI and QI with individual reactor
        modeling, refueling cycles become much more synchronized during and
        after the fuel shortage resuting in large power fluctuations - an artifact of the
        \emph{cycle staggering effect}.
    }
    \label{fig:power}
\end{figure*}

\begin{figure*}[!h]
    \centering
    \includegraphics[width=1.0\textwidth]{exp2/power-rel.eps}
    \caption[Normalized power]{
        Generated power is normalized to the expected 1\% exponential growth
        curve for all four cases.  A fuel shortage occurs from about year 100
        to about year 140.  The \emph{cycle staggering effect} can be seen as
        excessive divergence above and below $1.0$ in cases MI and QI where
        the shortage increases cycle synchronization significantly. The
        \emph{quantized shutdown effect} can also be seen in the discrepency
        between quarterly and monthly time steps for fleet reactor modeling
        (cases MF and QF) during the shortage; a longer time step causes more
        reactor outage than necessary. The consistent jumping up and down for
        the fleet reactor cases (even pre-shortage) is due to the mis-alignment of reactors going
        offline (multiples of 12 months) and the build period (21 months).
    }
    \label{fig:power-rel}
\end{figure*}

\subsection{Fuel Shortage}

Figure \ref{fig:unfueled} shows the fuel shortage more explicitly for each of
the four cases. The individual reactor modeling cases result in more
cumulative outage than corresponding fleet-based cases. The quarterly time
step of cases QI and QF also make the outage significantly more severe. Cases MI
and QI exhibit approximately twice as much offline power as their corresponding
fleet based simulations in cases MF and QF.  The monthly time step simulations
also have roughly twice as much offline power as their corresponding quarterly
cases.

\begin{figure}[!h]
    \centering
    \includegraphics[width=1.0\columnwidth]{exp2/unfueled.eps}
    \caption[Cumulative offline power due to fuel shortage]{
        Cumulative offline power for reactors that had delayed cycle start due
        to fuel shortage. The difference between individual and fleet based
        modeling is primarily a result of the \emph{fuel sharing effect}. The
        difference between monthly and quarterly time steps is primarily
        caused by the \emph{inventory drawdown effect}.
    }
    \label{fig:unfueled}
\end{figure}

Quantifying imperfect fuel sharing is a bit difficult, but Figure
\ref{fig:badshare} gives one way to approximate the \emph{fuel
sharing effect}.  Fleet reactor modeling by design exhibits perfect fuel
sharing by design (zero inefficiency) and so is not included in this figure.
Every batch that is given to a reactor that ends up not being able to start its
cycle at the scheduled time (due to fuel shortage) adds one to this cumulative
for each time step the cycle start is delayed.

One useful over-estimate of the fuel sharing inefficiency is to assume every
one of the "wasted" batches could have been given to a reactor enabling it to
operate.  Multiplying each of these cumulative batches by reactor capacity
(i.e. 450 MWe) provides a way to compare fuel sharing inefficiency with the
overall fuel outage.  This results in a cumulative offline power caused by
poor fuel sharing of roughly 2,000 $\text{GWe} \cdot \text{months}$ and 6,600
$\text{GWe} \cdot \text{months}$ for cases MI and QI respectively.  These
approximations are a significant portion of the difference between individual
and fleet cases in Figure \ref{fig:unfueled} suggesting that most of the
discrepency in cumulative outage between fleet and individual modeling is
caused by inefficient fuel sharing in the individual reactor cases.

The poor fuel sharing exhibited in the individual reactor cases would not
occur if there were no new reactors being built during the shortage.
Previously operating reactors only ever need one batch - receiving only a
single batch allows them to operate.  Newly constructed reactors need multiple
batches in order to begin operation, and if they receive less than a full core
they cannot operate.  The real world doesn't necessarily optimize for fuel
sharing efficiency very cleanly. There are many factors that can affect
real-world fuel sharing outcomes.  A few include:

\begin{enumerate}

    \item Multiple fuel quanta comprise a single batch (i.e. multiple
        assemblies per batch). This functionality is natively supported in the
        individual reactor model.

    \item On-hand fresh fuel inventory maintained at reactors. This
        functionality is natively supported in the individual reactor model.

    \item Long-term fuel contracts between reactors operators and fuel
        suppliers.

\end{enumerate}

Having multiple assemblies per batch (item 1 above) will further degrade fuel
sharing efficiency.  Even reactors that are short only one batch could
potentially receive some fuel and still be unable to operate.  In order to
maintain optimal sharing, fresh fuel now needs to be sent in all-or-nothing
multi-assembly quanta with higher preference to reactors that need fewer
assemblies.  Spare fresh fuel inventory (item 2 above) will have the global
effect of increasing total outage severity; on average more batches of fresh
fuel will be sitting unused.  However, it can potentially reduce the frequency
of outages for individual reactors in some cases.

If they were to ever occur, real world fuel shortages would likely not result
in optimal fuel sharing. However, modeling these the causes of suboptimal fuel
sharing is probably best accomplished with a more direct, intentional approach
rather than as a modeling artifact as seen here in cases MI and QI.  One way to
alleviate the poor fuel sharing is to modify the individual reactor model to
lower the preference value for requests for fresh fuel depending on how many
assemblies it needs to have a full core.  The more assemblies it needs, the
lower it will set its request preference.  This will have the effect of
allowing the resource exchange resolution in Cyclus to globally prefer sending
fuel to reactors that need less to operate.

\begin{figure}[!h]
    \centering
    \includegraphics[width=1.0\columnwidth]{exp2/badshare.eps}
    \caption[Cumulative unnecessary idling fuel]{
        Fuel sharing inefficiency approximated by the cumulative number of
        fuel batches given to each reactor on each refueling period multiplied
        by the number of time steps that reactor had to delay the start of its
        next cycle (due to fuel shortage).  Fleet reactors have perfect fuel
        sharing by design and so are not included here. The large difference
        between cases MI and QI is mostly due to the \emph{inventory drawdown
        effect}. 
    }
    \label{fig:badshare}
\end{figure}

\subsection{Inventory Drawdown}

The large differences seen between monthly and quarterly time step cases in
Figures \ref{fig:unfueled} and \ref{fig:badshare} are primarily caused by the
\emph{inventory drawdown effect}.  Figure \ref{fig:puinv} helps to visualize
this effect.  The black dots in the figure represent impulse flows of
available Pu out of the fuel fab and into fast reactors.  Blue lines represent
the flows into Pu inventory available for making fuel. The in-flows are not
shown for the individual reactor cases because they are somewhat messy and
obscure other information in the plots. The other colored curves show Pu inventory
available for fabricating fast reactor fuel.  When the inventory curves meet and
force down the out-flows, fuel shortages occur.  While this is most clear for
cases MF and QF, the individual reactor scenarios (cases MI and QI) also have many
points during the shortage where the outflow point lies exactly on top of the
inventory point - indicating that all available inventory is being
transferred.

Quarterly time steps have less frequent but larger impulse material flows.
The larger in-flows, however, do not compensate for the larger withdrawals
because facilities do not know about incoming inventory when they resolve
their outflow for a particular time step.  This information lag effectively
requires the floating Pu inventory to be maintained at a higher level during
the shortage.  This can be clearly seen in the case QF plot which has a higher
standing inventory than case MF during the fuel shortage years.  The case QF Pu
inventory is unable to drop below approximately 100 tonnes, which indicates
out-flows to be roughly equal to the Pu flow into inventory each time step
during those years.  This can be confirmed by the in-flow and inventory curves
touching at those points.  Case MF Pu inventory is similarly limited at about
the 30 tonne level.  As expected, the case QF withdrawals are also three times
higher case MF withdrawals exactly matching the time step duration ratio
between the two cases.

Throughout most of the shortage, the aggregate outflow of Pu from separated
inventory is roughly the same in cases MF and QF.  However, due to the longer
time steps in case QF, the shortage starts slightly sooner because Pu inventory
must be maintained at a higher limit as described above.  The small difference
in outage start time has feed-back effects.  Not only are extra reactors
offline, but those extra reactors are also discharging less aggregate spent
fuel for recycling.  This farther increases the discrepency between the two
cases. Eventually the shortage in case MF ends slightly before it does in case
QF. This feedback effect occurs because the reactors in question have a
conversion ratio greater than 1.0.

The horizontal striations visible in the monthly flows for case MI in Figure
\ref{fig:puinv} are a characteristic of the synchronization of reactor
refueling caused by the shortage.  They begin at the end of the fuel shortage
window when many reactors come online together and are resonances that the
inventory level jumps between.  These resonances gradually disappear as the
simulation progresses farther in time beyond the shortage and refueling cycles
become more staggered.

The in-flows shown for cases MF and QF show a periodic pulsing that begins
during the shortage in about year 120.  This pusling actually has nothing to
do with the shortage and is caused by the retirement of fast reactors.  The
first fast reactors are deployed in year 35 and have an 80 year lifetime.
When they retire, they discharge an entire core's worth of fuel rather than a
single batch.  After a 7-year cooling period, the first discharged full cores
begin to make it through the recycle loop in year 122.  Another interesting
feature visible in all four cases in Figure \ref{fig:puinv} is the minority
fraction of out-flow points that are higher than the bulk majority. These
higher out-flows occur once every 21 months when new reactors are built. The
new reactors require a full core of fresh fuel rather than the single batch
needed when just refueling.  

\begin{figure*}[!h]
    \centering
    \includegraphics[width=1.0\textwidth]{exp2/puinv.eps}
    \caption[Separated Pu inventory and flow]{
        Separated Pu inventory and flows for all four cases.  In-flows for
        cases MI and QI are omitted because they are noisy and obscure other
        useful information.  A larger time step results in larger per time
        step material flows. These larger flows mean more material is not
        available for supplying to requesters.  This information lag causes
        more supply constraints than occur with smaller time steps -
        illustrating the \emph{inventory drawdown effect}. Another result of
        this effect is the larger standing Pu inventory during the shortage
        with larger time steps that can be seen in case QF than in case MF.
    }
    \label{fig:puinv}
\end{figure*}

Figure \ref{fig:puinv-compare} shows the same inventory curves from Figure
\ref{fig:puinv} superimposed. Perhaps counter-intuitively, lower separated plutonium
inventory during the shortage generally indicates fewer unfueled reactors.
Lower inventory levels mean available Pu is being utilized more efficiently
rather than sitting idle.  Cases QI and QF with their longer time steps show
higher inventories indicating a more severe shortage.  Post shortage, they
also fall a bit behind on building up Pu stocks due to the delayed
contributions of more unfueled reactors to the separated Pu pool.  The
reactors in all the scenarios request fresh fuel only when they need it. While
this is an unrealistic behavior for real-world facilities, it is closer to a
globally optimum fuel management strategy.  Keeping on-hand fresh fuel batches
would also have the same effect of increasing idling plutonium quantities and
would make the fuel shortage worse overall.

\begin{figure*}[!h]
    \centering
    \includegraphics[width=1.0\textwidth]{exp2/puinv-compare.eps}
    \caption{
        Separated Pu inventories for all four cases.  Differences in modeling
        choices are not particularly significant until about year 100 when
        fuel shortages begin.  These differences gradually decay away starting
        in year 140 after the fuel shortages have ebbed.  Higher aggregate Pu
        inventory  during the shortage is correlated with a longer during and
        post shortage recovery period.
    }
    \label{fig:puinv-compare}
\end{figure*}

Also notable is that different modeling choices (e.g. time step duration,
facility discretization, etc.) may have varying levels of significance
depending on the scenario/context they are operating in.  As shown in Figure
\ref{fig:puinv-compare} before the fuel shortage begins, differences between
each of the four cases are relatively minor.  However, after the shortage
begins near year 100, separated Pu inventories vary much more significantly
between the different cases.

\section{Conclusion}

Different modeling choices can have a significant impact on the outcome of a
simulation.  With discrete reactor modeling many factors must be considered in
order to ensure the integrity of conclusions.  Individual reactor outage
modeling can be very useful for certain analyses, but it can reduce result
quality if things such as cycle staggering are not handled appropriately.  The
fleet and discreet models used here are just two points in a multi-dimensional
spectrum of modeling choices. If fuel sharing is of interest, but cycle
staggering is not, individual reactors can be used with the power capacity
lowered and the outage reduced to zero duration making the capacity factor
included in the reactor's power capacity.

Modeling reactors individually can provide valuable insight not possible with
the fleet-based reactor modeling.  For example, bringing reactors back online
following shortage-induced outages should not necessarily follow the natural
pacing of fuel availability, otherwise refueling cycles become
unsatisfactorily synchronized.  If individual reactor modeling fidelity is not
required, then performance benefits in both simulation run time and data
analysis may suggest a fleet-based modeling approach.

Increasing time step duration increases facilities' standing inventory
requirement during supply constrained periods.  Facilities can provide no more
inventory than they can hold on a single time step.  So increasing time step
duration for a facility with unconstrained supply generally means higher
standing inventories are required in order to achieve equal throughput.
Facilities with large inventory buffer that are unconstrained are not affected
significantly by the time step duration when operating in isolation.  However,
even when facilities do not have individual inventory or throughput limits,
the time step can still have a significant effect. In recycle loops there is a
constraint on how fast material is introduced through the loop (i.e. the
discharge rate of spent fuel from reactors).  The \emph{inventory drawdown
effect} can impact the aggregate throughput of the recycling loop by affecting
minimum bounds on idling material quantities.

The impact of modeling assumptions depends heavily on the metrics of interest.
For example, someone interested in fuel-shortage driven reactor outages would
observe a factor of four span among the four cases shown in the detail
comparison.  However, someone more interested in the overall transition
mechanics would not see as significant a discrepancy.  In an unconstrained
supply setting, varying the time step duration or discretization of facility
modeling have a relatively minor impact on the overall simulation results.
Differences become more significant in material constrained regimes.
Robustness in constrained regimes is especially useful in the context of
sensitivity and optimization analysis.

The value of realism in fuel cycle modeling is greatly be enhanced by an
associated understanding of how outcomes are affected by added fidelity.
Cyclus' flexibility for accomodating different modeling choices uniquely
enables many interesting comparisons.  Continued work in this direction has
great potential to to improve the integrity of fuel cycle analysis generally.

\section{Acknowledgements}

TODO: thank ross maybe for vision-sourced inspiration about modeling effects

This research is being performed in part using funding received from the DOE
Office of Nuclear Energy's Nuclear Energy University Programs.  The authors
thank the NEUP for its generous support.

\begin{center}
\includegraphics[width=1.5in]{neup_logo_large.jpg}
\end{center}

\pagebreak

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{ans}
\bibliography{refs}
\end{document}

